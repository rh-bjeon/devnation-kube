= Pod, ReplicaSet, Deployment


* *Terminal#1ì—ì„œ ìˆ˜í–‰*

image::2-3.png[2-3]

ë¨¼ì € ì‘ì—…í•  í”„ë¡œì íŠ¸ë¥¼ ë§Œë“­ë‹ˆë‹¤. 

* `myspace-%userid%` í”„ë¡œì íŠ¸ ìƒì„±
[#create-namespace]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc new-project myspace-%userid%
----

* `myspace-%userid%` í”„ë¡œì íŠ¸ë¡œ ì „í™˜
[#create-namespace]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc project myspace-%userid% 
----


== Pod

NOTE: Pod ìƒì„± ëª…ë ¹ì–´ ì‹¤í–‰ ì „ì— ì•„ë˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ë‘ë©´, Pod ìƒì„± ë‹¨ê³„ì—ì„œ Podì˜ ìƒíƒœ ë³€í™”ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

* *Terminal#1ì—ì„œ ìˆ˜í–‰*
[#watch-pod]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
watch oc get pods
----

[.console-output]
[source,bash]
----
NAME           READY   STATUS              RESTARTS   AGE
quarkus-demo   0/1     ContainerCreating   0          10s
----


[.console-output]
[source,bash]
----
NAME           READY   STATUS    RESTARTS   AGE
quarkus-demo   1/1     Running   0          18s
----

NOTE: ì•„ì§ì€ Podë¥¼ ìƒì„±í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ì•„ë¬´ëŸ° Pod ì •ë³´ë„ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ í†µí•´ Pod ìƒì„±ì‹œ, `ContainerCreating` ìƒíƒœì—ì„œ `Running` ìƒíƒœë¡œ ë³€ê²½ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


* *Terminal#1 ì˜†ì˜ `+` ë²„íŠ¼ì„ ëˆŒëŸ¬ Terminal#2 ìƒì„±*
* *ì•„ë˜ ëª…ë ¹ì–´ëŠ” Terminal#2ì—ì„œ ì‹¤í–‰*

[#create-namespace]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc project myspace-%userid% 
----

https://kubernetes.io/docs/concepts/configuration/overview/#naked-pods-vs-replicasets-deployments-and-jobs[naked pod]ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.:

[#create-pod]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
cat <<EOF | oc apply -f -
apiVersion: v1
kind: Pod
metadata:
  name: quarkus-demo
spec:
  containers:
  - name: quarkus-demo
    image: quay.io/rhdevelopers/quarkus-demo:v1
EOF
----


Podì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ í™•ì¸:

[#verify-pod]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc exec -it quarkus-demo -- /bin/sh
----

ë‹¤ìŒ ëª…ë ¹ì„ ì‹¤í–‰í•˜ì„¸ìš”.
ì»¨í…Œì´ë„ˆ ì¸ìŠ¤í„´ìŠ¤ ë‚´ë¶€ë¡œ ì ‘ì†í–ˆê¸° ë•Œë¬¸ì— í˜¸ìŠ¤íŠ¸ ì´ë¦„ì€ 'localhost'ì…ë‹ˆë‹¤.

[#curl-inside-pod]
[.console-input]
[source,bash]
----
curl localhost:8080
----

ê·¸ëŸ¼ ì•„ë˜ì™€ ê°™ì€ ë¬¸ì¥ì„ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[.console-output]
[source,bash]
----
Supersonic Subatomic Java with Quarkus quarkus-demo:1
----

podì—ì„œ ë¹ ì ¸ ë‚˜ì˜¤ì„¸ìš”.

[#curl-inside-pod]
[.console-input]
[source,bash]
----
exit
----

ì´ì œ Podë¥¼ ì‚­ì œí•´ ë³´ê² ìŠµë‹ˆë‹¤.

[#delete-naked-pod]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc delete pod quarkus-demo
----

* *Terminal#2ì—ì„œ í™•ì¸*

[#watch-all-naked-pod]
[.console-input]
[source,bash]
----
watch oc get pods
----

[.console-output]
[source,bash]
----
NAME           READY   STATUS        RESTARTS   AGE
quarkus-demo   0/1     Terminating   0          9m35s

No resources found in myspace namespace.
----

NOTE: `Naked pod` ëŠ” í´ëŸ¬ìŠ¤í„°ì—ì„œ ì˜ì›íˆ ì‚­ì œë©ë‹ˆë‹¤. ì´ì²˜ëŸ¼ ì§ì ‘ podë§Œ ìƒì„±í•˜ê²Œ ë˜ëŠ” Naked PodsëŠ” ë…¸ë“œ ì¥ì•  ë°œìƒ ì‹œ ì¬ì˜ˆì•½ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤. +
Podë¥¼ ì§ì ‘ ìƒì„±í•˜ëŠ” ëŒ€ì‹  Deploymentë¥¼ ìƒì„±í•˜ë©´, DeploymentëŠ” ReplicaSetì„ í†µí•´ íŠ¹ì • ê°œìˆ˜ì˜ Podê°€ í•­ìƒ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •í•˜ê³ , Podë¥¼ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•œ ì „ëµ(ì˜ˆ: RollingUpdate)ë„ ì§€ì •í•©ë‹ˆë‹¤. 
ë”°ë¼ì„œ ì¼ë¶€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì œì™¸í•˜ê³ ëŠ” Podë¥¼ ì§ì ‘ ìƒì„±í•˜ëŠ” ê²ƒë³´ë‹¤ Deploymentë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë°”ëŒì§í•©ë‹ˆë‹¤. 

NOTE: `watch` ëª…ë ¹ì–´ëŠ” [ctrl+c]ë¥¼ ì…ë ¥í•˜ì—¬ ë¹ ì ¸ ë‚˜ì˜µë‹ˆë‹¤.


== ReplicaSet
NOTE: OpenShift ì½˜ì†”ì˜ ì–¸ì–´ ì„¤ì •ì´ ì˜ì–´ì¼ ê²½ìš° 'ReplicaSets', í•œêµ­ì–´ì¼ ê²½ìš° 'ë³µì œ ì„¸íŠ¸'ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

ReplicaSet ìƒì„±:

* *Terminal#1ì—ì„œ ìˆ˜í–‰*

[#create-replicaset]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
cat <<EOF | oc apply -f -
apiVersion: apps/v1
kind: ReplicaSet
metadata:
    name: rs-quarkus-demo
spec:
    replicas: 3
    selector:
       matchLabels:
          app: quarkus-demo
    template:
       metadata:
          labels:
             app: quarkus-demo
             env: dev
       spec:
          containers:
          - name: quarkus-demo
            image: quay.io/rhdevelopers/quarkus-demo:v1
EOF
----

ë¼ë²¨ì´ ìˆëŠ” Pod ëª©ë¡ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.:

[#replicaset-show-labels]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
watch oc get pods --show-labels
----

[.console-output]
[source,bash]
----
NAME                    READY   STATUS    RESTARTS   AGE   LABELS
rs-quarkus-demo-jd6jk   1/1     Running   0          58s   app=quarkus-demo,env=dev
rs-quarkus-demo-mlnng   1/1     Running   0          58s   app=quarkus-demo,env=dev
rs-quarkus-demo-t26gt   1/1     Running   0          58s   app=quarkus-demo,env=dev
----


* *Terminal#2ì—ì„œ ìˆ˜í–‰*

[#get-rs]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc get rs
----

[.console-output]
[source,bash]
----
NAME              DESIRED   CURRENT   READY   AGE
rs-quarkus-demo   3         3         3       79s
----

Replicasets ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.:

[#describe-rs-quarkus-demo]
[.console-input]
[source,bash]
----
oc describe rs rs-quarkus-demo
----

[.console-output]
[source,bash]
----
Name:         rs-quarkus-demo
Namespace:    myspace
Selector:     app=quarkus-demo
Labels:       <none>
Annotations:  kubectl.kubernetes.io/last-applied-configuration:
                {"apiVersion":"apps/v1","kind":"ReplicaSet","metadata":{"annotations":{},"name":"rs-quarkus-demo","namespace":"myspace"},"spec":{"replicas...
Replicas:     3 current / 3 desired
Pods Status:  3 Running / 0 Waiting / 0 Succeeded / 0 Failed
Pod Template:
  Labels:  app=quarkus-demo
           env=dev
  Containers:
   quarkus-demo:
    Image:        quay.io/rhdevelopers/quarkus-demo:v1
    Port:         <none>
    Host Port:    <none>
    Environment:  <none>
    Mounts:       <none>
  Volumes:        <none>
Events:
  Type    Reason            Age   From                   Message
  ----    ------            ----  ----                   -------
  Normal  SuccessfulCreate  89s   replicaset-controller  Created pod: rs-quarkus-demo-jd6jk
  Normal  SuccessfulCreate  89s   replicaset-controller  Created pod: rs-quarkus-demo-t26gt
  Normal  SuccessfulCreate  89s   replicaset-controller  Created pod: rs-quarkus-demo-mlnng
----

NOTE: PodëŠ” ReplicaSetì— ì˜í•´ "ì†Œìœ "ë©ë‹ˆë‹¤.


ì´ì œ Podë¥¼ í™•ì¸í•˜ë©´ì„œ Podë¥¼ ì‚­ì œí•˜ì„¸ìš”.:


[#replicaset-show-labels]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc get pods 
----

[.console-output]
[source,bash]
----
NAME                    READY   STATUS    RESTARTS   AGE  
rs-quarkus-demo-jd6jk   1/1     Running   0          58s   
rs-quarkus-demo-mlnng   1/1     Running   0          58s   
rs-quarkus-demo-t26gt   1/1     Running   0          58s   
----


[#delete-pod-rs]
[.console-input]
[source,bash]
----
oc delete pod <PODì´ë¦„>
----

IMPORTANT: ìœ„ ëª…ë ¹ì–´ëŠ” ê·¸ëŒ€ë¡œ ë³µì‚¬í•˜ì—¬ ì‚¬ìš©í•˜ì§€ ë§ˆì‹œê³ , ëª…ë ¹ì–´ì˜ `<PODì´ë¦„>` ë¶€ë¶„ì„ ì‹¤ì œ ì¡°íšŒëœ podì˜ ì´ë¦„ìœ¼ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.+
ReplicaSetì€ Podë¥¼ ì¼ì • ìˆ˜ë¡œ ìœ ì§€í•˜ë ¤ê³  í•˜ê¸° ë•Œë¬¸ì—, ê´€ë¦¬í•˜ê³  ìˆëŠ” Podê°€ ì‚­ì œë˜ë©´ ì´ë¥¼ ëŒ€ì²´í•  ìƒˆë¡œìš´ Podë¥¼ ìƒì„±í•©ë‹ˆë‹¤ë‹¤.

[.console-output]
[source,bash]
----
NAME                    READY   STATUS              RESTARTS   AGE    LABELS
rs-quarkus-demo-2txwk   0/1     ContainerCreating   0          2s     app=quarkus-demo,env=dev
rs-quarkus-demo-jd6jk   1/1     Running             0          109s   app=quarkus-demo,env=dev
rs-quarkus-demo-t26gt   1/1     Running             0          109s   app=quarkus-demo,env=dev
----

ì—°ê²°ëœ ëª¨ë“  Podë¥¼ ì œê±°í•˜ë ¤ë©´ ReplicaSetë¥¼ ì‚­ì œí•˜ì„¸ìš”.:

[#delete-rs]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
oc delete rs rs-quarkus-demo
----



== Deployment
NOTE: OpenShift ì½˜ì†”ì˜ ì–¸ì–´ ì„¤ì •ì´ ì˜ì–´ì¼ ê²½ìš° 'Deployment', í•œêµ­ì–´ì¼ ê²½ìš° 'ë°°í¬'ë¡œ í‘œì‹œë©ë‹ˆë‹¤.

ì´ë²ˆì—ëŠ” Deploymentë¥¼ ë°°í¬í•´ë³´ê² ìŠµë‹ˆë‹¤.

DeploymentëŠ” Kubernetesì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ë°°í¬ë¥¼ ì •ì˜í•˜ëŠ” ê°ì²´ì…ë‹ˆë‹¤.

DeploymentëŠ” Replicasetë¥¼ í†µí•´ Podë¥¼ ë°°í¬í•˜ë©°, ë°°í¬í•  Podì˜ specì´ ë³€í™”í•˜ë©´ ìƒˆë¡œìš´ Replicasetì„ ìƒì„±í•˜ì—¬ ìƒˆë¡œìš´ Podë¥¼ ë°°í¬í•˜ëŠ” ì‹ìœ¼ë¡œ ì´ë ¥ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.

ì´ë¥¼ í†µí•´ ìë™ ë³µêµ¬, ë¡¤ë§ ì—…ë°ì´íŠ¸, ë²„ì „ ê´€ë¦¬ê°€ ê°€ëŠ¥í•´ì§‘ë‹ˆë‹¤.

ğŸ’¡ Deploymentì˜ ë™ì‘ ë°©ì‹
(1) Deployment ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ë©´ ReplicaSet(ë³µì œ ì„¸íŠ¸) ê°ì²´ê°€ ìë™ìœ¼ë¡œ ìƒì„±ë¨
(2) ReplicaSetì€ ì§€ì •ëœ ê°œìˆ˜ë§Œí¼ì˜ Pods(íŒŒë“œ)ë¥¼ ì‹¤í–‰ ë° ê´€ë¦¬
(3) ëª¨ë“  ë¦¬ì†ŒìŠ¤ëŠ” Labels(ë ˆì´ë¸”)ê³¼ Selectors(ì…€ë ‰í„°)ë¥¼ í†µí•´ ì—°ê²°ë¨
(4) íŠ¸ë˜í”½ì„ íŠ¹ì • íŒŒë“œë¡œ ë¼ìš°íŒ…í•  ë•Œë„ Labelsì„ í™œìš©í•  ìˆ˜ ìˆìŒ

* *Terminal#2ì—ì„œ ìˆ˜í–‰*

[#create-deployment]
[.console-input]
[source,bash,subs="+macros,+attributes"]
----
cat <<EOF | oc apply -f -
apiVersion: apps/v1
kind: Deployment
metadata:
  name: quarkus-demo-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: quarkus-demo
  template:
    metadata:
      labels:
        app: quarkus-demo
        env: dev
    spec:
      containers:
      - name: quarkus-demo
        image: quay.io/rhdevelopers/quarkus-demo:v1
        imagePullPolicy: Always
        ports:
        - containerPort: 8080
EOF
----

ë¼ë²¨ì„ í¬í•¨í•œ pod ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

[#pod-show-labels-dep]
[.console-input]
[source,bash]
----
oc get pods --show-labels
----

[.console-output]
[source,bash]
----
NAME                                       READY   STATUS    RESTARTS   AGE   LABELS
quarkus-demo-deployment-5979886fb7-c888m   1/1     Running   0          17s   app=quarkus-demo,env=dev,pod-template-hash=5979886fb7
quarkus-demo-deployment-5979886fb7-gdtnz   1/1     Running   0          17s   app=quarkus-demo,env=dev,pod-template-hash=5979886fb7
quarkus-demo-deployment-5979886fb7-grf59   1/1     Running   0          17s   app=quarkus-demo,env=dev,pod-template-hash=5979886f
----

NOTE: Deploymentì— Replicas :3 ê°’ì´ í¬í•¨ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— 3ê°œì˜ Podê°€ ì‹¤í–‰ë¨ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 



ë‹¤ìŒ ì„¹ì…˜ì—ì„œëŠ” `Service` ì˜ ê°œë…ì„ ë°°ìš°ê²Œ ë©ë‹ˆë‹¤.
ì´ëŠ” Kubernetes ìƒíƒœê³„ì—ì„œ ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤.
